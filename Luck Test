from flask import Flask, request
app = Flask(__name__)

poems = [
    ("ğŸ€", "í–‰ìš´ì€ ì˜¤ëŠ˜ ë„ˆë¥¼ ì°¾ì•„ì˜¨ë‹¤\ní–‡ì‚´ ì† ë„ˆì˜ ì›ƒìŒì²˜ëŸ¼ ë°ê²Œ\nì¡°ìš©íˆ ê¸°ë‹¤ë¦° ë³´ìƒì´\në„¤ê²Œë¡œ ë‹¤ê°€ì˜¨ë‹¤, ê°€ë³ê²Œ."),
    ("ğŸ’–", "ë”°ëœ»í•œ ë§ˆìŒì´ í”¼ì–´ë‚˜ëŠ” ë‚ \në„ˆì˜ ì´ë¦„ì€ ì‚¬ë‘ì„ ë¶€ë¥¸ë‹¤\nì‘ì€ ì¸ì—°ë„ í° ê¸°ì¨ì´ ë˜ì–´\nì˜¤ëŠ˜ì„ ê°ì‹¸ì•ˆëŠ”ë‹¤."),
    ("âš ï¸", "ì¡°ì‹¬ìŠ¤ëŸ¬ìš´ ì„ íƒì´ í•„ìš”í•œ í•˜ë£¨\në§ë³´ë‹¤ ë§ˆìŒì„ ë“¤ì–´ë´\nê°€ë” ë©ˆì¶”ëŠ” ê²ƒì´\në” ë‚˜ì€ ê¸¸ì´ ë˜ê¸°ë„ í•´."),
    ("ğŸ“š", "ë°°ì›€ì´ ê½ƒí”¼ëŠ” ë‚ ì´ì•¼\nê¶ê¸ˆí–ˆë˜ ê²ƒì— ë‹µì´ ë³´ì´ê³ \në„ˆì˜ ì§€ì‹ì´ ìë¼ëŠ” ìˆœê°„\nìì‹ ê°ì´ ê¹ƒë“ ë‹¤."),
    ("ğŸ", "ì˜ˆìƒ ëª»í•œ ì„ ë¬¼ì´ ë„ì°©í•œë‹¤\në§ˆìŒì´ ë”°ëœ»í•´ì§€ëŠ” ë©”ì‹œì§€ë‚˜\nì‘ì€ ê¸°íšŒ í•˜ë‚˜ê°€\në„¤ í•˜ë£¨ë¥¼ ë°”ê¾¼ë‹¤."),
    ("ğŸ’¡", "ì•„ì´ë””ì–´ê°€ ìƒ˜ì†ŸëŠ” ë‚ \në©ˆì¶°ìˆë˜ í¼ì¦ì´ ë§ì¶°ì§€ê³ \në„ˆì˜ ìƒê°ì´ ë¹›ì„ ë‚¸ë‹¤\nì§€ê¸ˆ ë– ì˜¤ë¥´ëŠ” ê±¸ ì ì–´ë´."),
    ("ğŸ§˜", "ë§ˆìŒì´ ê³ ìš”í•´ì§€ëŠ” í•˜ë£¨\në°”ëŒì²˜ëŸ¼ ë„ˆë„ ê°€ë³ê²Œ í˜ëŸ¬\në¬´ê±°ì› ë˜ ìƒê°ì„ ë†“ê³ \nìˆ¨ì„ ê¹Šì´ ë“¤ì´ë§ˆì…”ë´."),
    ("ğŸ˜´", "ì¡°ìš©í•œ ì‰¼ì´ í•„ìš”í•œ ë‚ \nì§€ì¹œ ë„ˆì—ê²Œ í¬ê·¼í•œ ì‹œê°„ì´\në³„ë¹›ì²˜ëŸ¼ ë‹¤ê°€ì˜¨ë‹¤\nì§€ê¸ˆì€ ì¶©ë¶„íˆ ì‰¬ì–´ë„ ë¼."),
    ("ğŸŒ§ï¸", "ê°ì •ì´ í”ë“¤ë¦´ ìˆ˜ ìˆì–´\ní•˜ì§€ë§Œ ê·¸ê±´ íë¦¼ì´ ì•„ë‹ˆë¼\në‹¤ì‹œ ë¹›ë‚  ì¤€ë¹„\në„ˆì˜ ë§ˆìŒë„ ê·¸ë˜."),
    ("ğŸ˜", "ìì‹ ê° ë„˜ì¹˜ëŠ” ë„ˆì˜ í•˜ë£¨\nê±°ìš¸ ì† ë¯¸ì†Œê°€ ë§í•˜ì–ì•„\në„ì „í•˜ê¸° ì¢‹ì€ íƒ€ì´ë°\nì˜¤ëŠ˜ì€ ë„ˆì˜ ë¬´ëŒ€ì•¼!")
]

@app.route("/", methods=["GET", "POST"])
def index():
    if request.method == "POST":
        name = request.form["name"]
        birth = request.form["birth"]
        favnum = int(request.form["favnum"])

        seed = len(name) + favnum + sum(int(x) for x in birth.replace("-", ""))
        emoji, poem = poems[seed % len(poems)]

        return f"""
        <!DOCTYPE html>
        <html lang="ko">
        <head>
          <meta charset="UTF-8">
          <title>ğŸŒ™ ê°ì„± ìš´ì„¸ ì‹œ</title>
          <style>
            body {{
              font-family: 'Nanum Gothic', sans-serif;
              text-align: center;
              background-color: #f5f5f5;
              padding: 50px;
            }}
            input, button {{
              padding: 10px;
              margin: 10px;
              font-size: 18px;
            }}
            #poem-card {{
              margin-top: 30px;
              padding: 30px;
              background-color: white;
              border-radius: 20px;
              width: 400px;
              font-size: 20px;
              white-space: pre-line;
              margin-left: auto;
              margin-right: auto;
              box-shadow: 0 0 10px rgba(0,0,0,0.1);
            }}
            #downloadBtn {{
              margin-top: 20px;
              font-size: 16px;
              padding: 10px 20px;
              cursor: pointer;
            }}
          </style>
        </head>
        <body>
          <h1>ğŸ”® ì˜¤ëŠ˜ì˜ ê°ì„± ìš´ì„¸ ì‹œ</h1>
          <form method="POST">
            <input type="text" name="name" placeholder="ì´ë¦„" required /><br />
            <input type="date" name="birth" required /><br />
            <input type="number" name="favnum" placeholder="ì¢‹ì•„í•˜ëŠ” ìˆ«ì" required /><br />
            <button type="submit">ì‹œ í™•ì¸í•˜ê¸° âœ¨</button>
          </form>

          <div id="poem-card">
            <p style="font-size: 32px;">{emoji}</p>
            <p><strong>{name}</strong>ë‹˜ì˜ ìš´ì„¸ ì‹œ</p>
            <p>{poem}</p>
          </div>
          <button id="downloadBtn">ğŸ–¼ï¸ ì´ë¯¸ì§€ë¡œ ì €ì¥</button>

          <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
          <script>
            const btn = document.getElementById("downloadBtn");
            if (btn) {{
              btn.addEventListener("click", () => {{
                const card = document.getElementById("poem-card");
                html2canvas(card).then(canvas => {{
                  const link = document.createElement("a");
                  link.download = "ìš´ì„¸_ì‹œ.png";
                  link.href = canvas.toDataURL("image/png");
                  link.click();
                }});
              }});
            }}
          </script>
        </body>
        </html>
        """
    return """
    <!DOCTYPE html>
    <html lang="ko">
    <head>
      <meta charset="UTF-8">
      <title>ğŸŒ™ ê°ì„± ìš´ì„¸ ì‹œ</title>
      <style>
        body {
          font-family: 'Nanum Gothic', sans-serif;
          text-align: center;
          background-color: #f5f5f5;
          padding: 50px;
        }
        input, button {
          padding: 10px;
          margin: 10px;
          font-size: 18px;
        }
      </style>
    </head>
    <body>
      <h1>ğŸ”® ì˜¤ëŠ˜ì˜ ê°ì„± ìš´ì„¸ ì‹œ</h1>
      <form method="POST">
        <input type="text" name="name" placeholder="ì´ë¦„" required /><br />
        <input type="date" name="birth" required /><br />
        <input type="number" name="favnum" placeholder="ì¢‹ì•„í•˜ëŠ” ìˆ«ì" required /><br />
        <button type="submit">ì‹œ í™•ì¸í•˜ê¸° âœ¨</button>
      </form>
    </body>
    </html>
    """

if __name__ == "__main__":
    app.run(debug=True)

